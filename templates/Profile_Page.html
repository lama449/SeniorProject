<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Profile Page</title>
    <link rel="stylesheet" href="{{url_for('static', filename='homestyles.css')}}">
    <link rel="icon" href="{{url_for('static', filename='calendar icon.png')}}">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.js" crossorigin="anonymous"></script>
</head>
<body>
    {% include 'header.html' %}

    <div class="content" id="app">

        <h4 style="padding-left: 5em">Profile</h4>
        <div style="padding-left: 10em">
            <h6><b><label for="fname">First Name: </label></b>
            <h6 style="margin-left: 10em"> <input type="text"  name="first_name" id="fname" v-model:placeholder="first_name"></h6>
            <h6><b><label for="lname">Last Name: </label></b></h6>
            <h6 style="margin-left: 10em"> <input type="text"  name="last_name" id="lname" v-model:placeholder="last_name"></h6>
            <h6><b><label for="email">Email: </label></b></h6>
            <h6 style="margin-left: 10em"> <input type="email" name="email" id="email" v-model:placeholder="email"></h6>
            <h6><b><label for="password">Password: </label></b></h6>
            <button style="margin-left: 10em" type="submit" class="button"><a onclick="document.getElementById('modalwrapper').style.display='block'" id="password">Click here to change password</a></button></h6>
            <div id = "modalwrapper" class = "modal">
                <form class="modal-content animate">
                    <div class="container" style="background-color: white">
                        <span onclick="document.getElementById('modalwrapper').style.display='none'" class="close" title="Close Popup">&times;</span>
                        <h1 style="text-align: center; background-color: white; padding-top: 25px">Change Password</h1>
                    </div>
                    <div class="container" style="background-color: white">
                        <input type="password" class = "full-width" placeholder="Enter Old Password" name = "opsw" maxlength="240" v-model = "opsw">
                        <input type="password" class = "full-width" placeholder="Enter New Password" name = "npsw" maxlength="240" v-model = "npsw">
                        <input type="password" class = "full-width" placeholder="Confirm New Password" name = "cpsw" maxlength="240" v-model = "cpsw">
                        <button type="submit"  class="button" style="margin: 0 auto; display: block" @click.prevent="checkPassword()">Change Password</button>
                    </div>
                </form>
            </div>
            <h6><b><label for="question">Security Question: </label></b></h6>
            <button style="margin-left: 10em" type="submit" class="button"><a onclick="document.getElementById('modalwrapper2').style.display='block'" id="question">Click here to change security question/answer</a></button></h6>
            <div id = "modalwrapper2" class = "modal">
                <form class="modal-content animate">
                    <div class="container" style="background-color: white">
                        <span onclick="document.getElementById('modalwrapper2').style.display='none'" class="close" title="Close Popup">&times;</span>
                        <h1 style="text-align: center; background-color: white; padding-top: 25px">Change Security Details</h1>
                    </div>
                    <div class="container" style="background-color: white">
                        <select v-model="question">
                            <option value="What is your favorite book?">What is your favorite book?</option>
                            <option value="What is the name of the road you grew up on?">What is the name of the road you grew up on?</option>
                            <option value="What is your mother’s maiden name?">What is your mother’s maiden name?</option>
                            <option value="What was the name of your first/current/favorite pet?">What was the name of your first/current/favorite pet?</option>
                            <option value="What was the first company that you worked for?">What was the first company that you worked for?</option>
                            <option value="Where did you meet your spouse?">Where did you meet your spouse?</option>
                            <option value="Where did you go to high school/college?">Where did you go to high school/college?</option>
                            <option value="What is your favorite food?">What is your favorite food?</option>
                            <option value="What city were you born in?">What city were you born in?</option>
                            <option value="Where is your favorite place to vacation?">Where is your favorite place to vacation?</option>
                        </select>
                        <h6><b><label for="answer">Answer: </label></b></h6>
                        <h6 style="margin-left: 10em"> <input type="password" name="answer" id="answer" v-model:placeholder="answer"></h6>
                        <button type="submit"  class="button" style="margin: 0 auto; display: block" @click.prevent="checkAnswer()">Confirm Changes</button>
                    </div>
                </form>
            </div>
            <button type="submit" class="button">Save changes</button>
        </div>
    </div>
    {% include 'footer.html' %}

</body>

<script>
    var vc = new Vue({
        el: "#app",
        data: {
            first_name: "",
            last_name: "",
            email: "",
            opsw: "",
            npsw: "",
            cpsw: "",
            question: "",
            answer: ""
        },
        mounted(){
            axios
                .get("/api/users")
                .then(res => {
                    this.first_name = res.data.first_name
                    this.last_name = res.data.last_name
                    this.email = res.data.email
                    this.answer = res.data.answer
                    this.question = res.data.question
                })
                .catch(error => console.log(error))
        },
        delimiters: ["[[", "]]"],
        methods: {
            getDetails: function () {
                axios
                    .put("{{ url_for('user') }}", {
                        first_name: this.first_name,
                        last_name: this.last_name,
                        email: this.email,
                        question: this.question,
                        answer: this.answer
                    })
                    .then(res => {
                        if ("msg" in res.data && res.data.msg.length) {
                            window.location.reload(false);
                        } else {
                            this.error = res.data.err;
                        }
                    })
                    .catch(error => console.log(error))
            },
            checkPassword: function () {
                this.confirmPassword();
                axios
                    .put("{{ url_for('user') }}", {
                        opsw: this.opsw,
                        npsw: this.npsw,
                        cpsw: this.cpsw
                    })
                    .then(res => {
                        if ("msg" in res.data && res.data.msg.length) {
                            window.location.reload(false);
                        } else {
                            this.error = res.data.err;
                        }
                    })
                    .catch(error => console.log(error))
            },
            checkAnswer: function () {
                this.confirmAnswer();
                axios
                    .put("{{ url_for('user') }}", {
                        question: this.question,
                        answer: this.answer
                    })
                    .then(res => {
                        if ("msg" in res.data && res.data.msg.length) {
                            window.location.reload(false);
                        } else {
                            this.error = res.data.err;
                        }
                    })
                    .catch(error => console.log(error))
            },
            confirmPassword: function() {
                opsw = this.opsw;
                npsw = this.npsw;
                cpsw = this.cpsw;
                // If old password not entered
                if (opsw == '') {
                    alert("Please enter password");
                    return false
                }
                // If new password not entered
                else if (npsw == '') {
                    alert("Please enter new password");
                    return false;
                }
                 // If confirm password not entered
                else if (cpsw == '') {
                    alert("Please enter confirm password");
                    return false;
                }
                // If Not same return False.
                else if (npsw != cpsw) {
                    alert("New password did not match: Please try again.");
                    return false;
                }
                return true;
            },
            confirmAnswer: function() {
                question = this.question;
                answer = this.answer;

                // If old password not entered
                if (question.trim() == "") {
                    alert("Please select a security question.");
                    return false
                }
                // If new password not entered
                else if (answer.trim() == "") {
                    alert("Please input an answer for the security question.");
                    return false;
                }
                return true;
            }
        }
    })

</script>
</html>